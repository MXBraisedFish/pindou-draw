<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8" />
  <title>像素画色卡助手</title>
  <link rel="stylesheet" href="/pindou-draw/style.css" />
</head>

<body>
  <div class="app-shell">
    <!-- 顶部标题栏 -->
    <header class="app-header">
      <div class="header-text">
        <h1>拼豆像素画工具</h1>
        <p>由"闷香红烧鱼"制作，详细使用可看右侧说明书</p>
      </div>
      <button id="docsToggleBtn" class="docs-toggle" type="button" aria-pressed="false" aria-label="打开说明书" title="说明书">
        ？
      </button>
    </header>

    <!-- 主内容区域 -->
    <main class="app-main">
      <!-- 左侧画布区 -->
      <section class="canvas-pane">
        <!-- 工具栏 -->
        <div class="canvas-toolbar">
          <!-- 导入导出部分 -->
          <div class="toolbar-section">
            <button id="importBaseBtn" type="button">导入底图</button>
            <button id="clearBaseBtn" type="button">移除底图</button>
            <button id="importProjectBtn" type="button">导入 PD</button>
            <button id="exportProjectBtn" type="button">导出 PD</button>
            <button id="exportBtn" type="button">导出图片</button>
            <select id="exportFormat">
              <option value="image/png">PNG</option>
              <option value="image/jpeg">JPEG</option>
            </select>
          </div>

          <!-- 绘画工具部分 -->
          <div class="toolbar-section">
            <div class="tool-toggle" role="group" aria-label="绘制工具">
              <button id="toolPencilBtn" type="button" class="tool-btn active" data-tool="pencil" aria-pressed="true">
                铅笔
              </button>
              <button id="toolBucketBtn" type="button" class="tool-btn" data-tool="bucket" aria-pressed="false">
                油漆桶
              </button>
            </div>

            <label class="inline-control">
              <input type="checkbox" id="autoSnapToggle" />
              <span>自动贴合底图颜色</span>
            </label>

            <label class="inline-control">
              <input type="checkbox" id="showCodesToggle" />
              <span>显示色号</span>
            </label>

            <label class="inline-control zoom-control">
              <span>缩放</span>
              <input type="range" id="zoomRange" min="4" max="80" step="1" value="10" />
            </label>

            <button id="toggleFullscreenBtn" type="button">全屏绘制</button>
            <button id="toggleReferenceBtn" type="button" aria-pressed="false">
              参考图窗
            </button>
          </div>
        </div>

        <!-- 画布 -->
        <div id="canvasWrapper" class="canvas-wrapper">
          <div id="canvasStage" class="canvas-stage">
            <canvas id="baseCanvas"></canvas>
            <canvas id="drawingCanvas"></canvas>
          </div>
        </div>

        <!-- 全屏色卡 -->
        <div id="fullscreenPalette" class="fullscreen-palette" aria-hidden="true"></div>

        <!-- 隐藏文件输入 -->
        <input id="baseImageInput" type="file" accept="image/*" hidden />
        <input id="referenceImageInput" type="file" accept="image/*" multiple hidden />
        <input id="projectFileInput" type="file" accept=".pd,application/json" hidden />
      </section>

      <!-- 右侧控制区 -->
      <aside class="side-pane">
        <!-- 新建画布 -->
        <section class="panel">
          <h2>新建画布</h2>
          <div class="form-row">
            <label for="widthInput">宽度 (像素)</label>
            <input id="widthInput" type="number" min="1" max="256" value="32" />
          </div>
          <div class="form-row">
            <label for="heightInput">高度 (像素)</label>
            <input id="heightInput" type="number" min="1" max="256" value="32" />
          </div>
          <button id="createCanvasBtn" type="button">新建画布</button>
          <div class="form-row">
            <label for="canvasOpacityRange">画布背景透明度
              <span id="canvasOpacityValue">90%</span></label>
            <input id="canvasOpacityRange" type="range" min="0" max="100" step="5" value="90" />
          </div>
        </section>

        <!-- 色卡管理 -->
        <section class="panel">
          <h2>色卡</h2>
          <div class="form-row">
            <label for="paletteHistorySelect">已加载色卡</label>
            <select id="paletteHistorySelect">
              <option value="__none">请选择色卡</option>
            </select>
          </div>

          <div class="palette-actions">
            <button id="loadDefaultPaletteBtn" type="button">加载内置 DMC</button>
            <button id="importPaletteBtn" type="button">导入色卡 JSON</button>
            <button id="deletePaletteBtn" type="button">删除当前色卡</button>
            <input id="paletteFileInput" type="file" accept="application/json" hidden />
          </div>

          <div class="form-row">
            <label for="paletteFilter">筛选色号/颜色</label>
            <input id="paletteFilter" type="search" placeholder="输入色号或关键字" />
          </div>

          <div class="current-color" id="currentColorInfo">
            当前色号：<span class="code">无</span>
          </div>

          <div id="paletteContainer" class="palette-grid"></div>
        </section>

        <!-- 底图设置 -->
        <section class="panel">
          <h2>底图设置</h2>
          <div class="form-row">
            <label for="baseLayerSelect">底图图层</label>
            <select id="baseLayerSelect" disabled>
              <option value="under">底图在画布下</option>
              <option value="over">底图在画布上</option>
              <option value="hidden">隐藏底图</option>
            </select>
          </div>

          <div class="base-tool-row">
            <button id="toggleBaseEditBtn" type="button" disabled>底图编辑</button>
            <button id="recenterBaseBtn" type="button" disabled>底图居中</button>
            <button id="snapBaseToCanvasBtn" type="button" disabled>贴合画布</button>
          </div>

          <div class="form-row base-scale-row">
            <label for="baseScaleRange">底图缩放
              <span id="baseScaleValue">100%</span></label>
            <input id="baseScaleRange" type="range" min="0.1" max="8" step="0.01" value="1" disabled />
          </div>
        </section>

        <!-- 状态显示 -->
        <section class="panel">
          <h2>状态</h2>
          <ul class="status-list">
            <li>画布：<span id="statusSize">未创建</span></li>
            <li>底图：<span id="statusBase">未导入</span></li>
            <li>色卡：<span id="statusPalette">未加载</span></li>
          </ul>
        </section>
      </aside>
    </main>
  </div>

  <!-- 参考图窗口 -->
  <div id="referenceWindow" class="reference-window" aria-hidden="true">
    <div id="referenceHeader" class="reference-header">
      <span class="reference-title">参考图</span>
      <div class="reference-actions">
        <button id="referenceAddBtn" type="button" aria-label="添加参考图">+</button>
        <button id="referenceMinimizeBtn" type="button" aria-label="最小化参考窗">-</button>
        <button id="referenceCloseBtn" type="button" aria-label="关闭参考窗">X</button>
      </div>
    </div>
    <div class="reference-body">
      <div id="referenceList" class="reference-list"></div>
    </div>
    <div id="referenceResizer" class="reference-resizer" aria-hidden="true"></div>
  </div>

  <!-- 说明书窗口 -->
  <div id="docsWindow" class="docs-window" aria-hidden="true" tabindex="-1">
    <div class="docs-header">
      <span class="docs-title">说明书</span>
      <button id="docsCloseBtn" type="button" aria-label="关闭说明书">✕</button>
    </div>
    <div class="docs-body">
      <!-- 保留你原有说明书内容 -->
      <h1>拼豆像素画工具说明书</h1>
      <h2>🧑‍🎨 作者信息</h2>
      <p>由 <strong>闷香红烧鱼</strong> 制作。</p>
      <ul>
        <li>Bilibili：<a href="https://space.bilibili.com/609170202" target="_blank">闷香红烧鱼</a></li>
        <li>小红书：<a href="https://www.xiaohongshu.com/user/profile/65f420e30000000005008498" target="_blank">闷香红烧鱼</a>
        </li>
      </ul>
      <p>本网页完全免费使用，希望能方便大家进行拼豆手工草图创作( •̀ ω •́ )✧</p>
      <p>可以收藏下来方便以后使用！</p>
      <p>目前适用于电脑端，移动端会在未来做响应式<br />`(*>﹏<*)′ </p>

          <hr>

          <h2>🪄 基础使用</h2>
          <ol>
            <li>创建画布。</li>
            <li>从色卡中选择颜色进行上色。</li>
            <li>完成后导出图片即可保存作品。</li>
          </ol>

          <hr>

          <h2>🖼 画布操作</h2>
          <ul>
            <li><strong>左键</strong>：绘制像素(铅笔和油漆桶操作相同)。</li>
            <li><strong>右键</strong>：擦除像素(铅笔和油漆桶操作相同)。</li>
            <li><strong>滚轮滚动</strong>：放大 / 缩小画布。</li>
            <li><strong>长按滚轮</strong>：拖动画布。</li>
            <li><strong>双击滚轮</strong>：重置画布视图。</li>
          </ul>

          <hr>

          <h2>🧩 底图与模板</h2>
          <ul>
            <li><strong>底图</strong>：会显示在画布底下，用于参考描绘。</li>
            <li><strong>模板图</strong>：会显示在独立的参考窗口中，可自由拖动和缩放。</li>
          </ul>

          <hr>

          <h2>🔧 底图操作</h2>
          <ol>
            <li>点击「<strong>编辑底图</strong>」按钮进入底图编辑模式。</li>
            <li>在该模式下：
              <ul>
                <li><strong>长按左键</strong> 可拖动底图位置。</li>
                <li><strong>滚轮滚动</strong> 可缩放底图比例。</li>
              </ul>
            </li>
          </ol>

          <hr>

          <h2>📁 导入与导出</h2>
          <ul>
            <li><strong>导出格式：</strong>
              <ul>
                <li>图片：支持 <strong>PNG</strong> 与 <strong>JPEG (JPG)</strong>。</li>
                <li>工程文件：<strong>.pd</strong> 格式，可在浏览器中导入继续编辑或分享。</li>
              </ul>
            </li>
            <li><strong>导入格式：</strong>
              <ul>
                <li>支持导入 <code>.pd</code> </li>
              </ul>
            </li>
          </ul>

          <hr>

          <h2>🎨 色卡</h2>
          <ul>
            <li>内置了常用的拼豆色卡。</li>
            <li>如果误删了一些内置色卡，可以在Github仓库中output目录下载色卡json文件补全。</li>
            <li>也可以手动导入自定义色卡 JSON 文件，格式如下：</li>
          </ul>

          <pre>        文件名：色卡名.json
        文件内容：
        {
          "A1": "RGB(2, 5, 7)",
          "A2": "RGB(10, 20, 255)",
          "颜色编号": "RGB(R, G, B)",
          ...
        }</pre>

          <p>键为颜色编号，值为 RGB 颜色值。</p>

          <hr>

          <h2>🪲 Bug 与反馈</h2>
          <p>如遇问题或功能建议，可在以下平台私信反馈：</p>
          <ul>
            <li>Bilibili：<a href="https://space.bilibili.com/609170202" target="_blank">闷香红烧鱼</a></li>
            <li>小红书：<a href="https://www.xiaohongshu.com/user/profile/65f420e30000000005008498"
                target="_blank">闷香红烧鱼</a>
            </li>
          </ul>
          <p>若出现严重 Bug，将及时修复并更新版本。</p>
    </div>
  </div>

  <script type="module" src="/pindou-draw/js/app.js"></script>
</body>

</html>